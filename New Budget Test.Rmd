---
title: "Budget Data Cleaning"
author: "Chelsea Ursaner & Brett Kobold"
date: "5/18/2017"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

##Appropriations

Appropriations are also known as budget expenses or allocations. The challenging piece here is to assign the 'priority outcome' which can fall into four categories: Make LA the Best Run City in America, Make LA the Safest.., Provide Good Jobs to All Angelenos, and Make LA the Most Livable and Sustainable Big City..

```{r}
library(dplyr) #moving and shaping the data
library(tidyr) #allows for melt and cast
library(magrittr) #pipeforwarding package %>% 
library(readxl) #reading the excel file
library(stringr) #working with strings eaiser
library(RSocrata)

#reading in data from data.lacity.org and downloaded files
#Pull existing data from Socrata
appropriations_existing <- read.socrata(url = 'https://data.lacity.org/A-Prosperous-City/Open-Budget-Appropriations-Fiscal-Years-2010-2018/5242-pnmt')


###This is not part of the general workflow, but I need to take out the appropriations I added that don't have all the right information
appropriations_existing <- appropriations_existing %>% filter(Fiscal_Year != 2018) 

#Export to start working in Excel to do a vlookup
write.csv(appropriations_existing, "working_appropriations.csv", row.names = F)

#Pull new data from Excel extract
setwd("~/R_labs/laBudget/FY17-18 Proposed Budget")
appropriations_new <- read_excel("Expenditures_Sec2 All Regular Depts and NonDepts_1718Proposed.xlsx", 1) %>% data.frame()

#make it look like the original dataset
appropriations_new <- appropriations_new %>% select(-c(13:15))

#Export to start working in Excel to do a vlookup
#working dataset
write.csv(appropriations_existing, "working_appropriations.csv", row.names = F)
#new values
write.csv(appropriations_new, "new_appropriations.csv", row.names = F)
```

... and do the rest in excel, tableau, and datasync unless we want to try it with R

```{r}
#Read the new new appropriations file
setwd("~/R_labs/laBudget/FY17-18 Proposed Budget")
appropriations_new <- read.csv("new_new_appropriations.csv")

#Make sure they match
names(appropriations_existing)
names(appropriations_new)

appropriations = rbind(appropriations_existing, appropriations_new)
write.csv(appropriations, 'appropriations_final.csv', row.names = F)
```

## Including Plots

You can also embed plots, for example:

```{r}

```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
